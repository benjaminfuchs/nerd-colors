// Update settings before leaving page.
$(window).bind('beforeunload', function(){
  if(document.getElementById("color").is(':focus') ||
      document.getElementById("brightness").is(':focus')) {
    console.log("Updating alarm with current settings before leaving page.");
    saveSettings();
  }
});

(function(window, document) {
  var settings;

  /* Global Functions */

  // Update settings via API call.
  window.saveSettings = function() {
    console.log("Updating alarm settings.");
    var xhttp = new XMLHttpRequest();

    getSettingsFromGui();
    xhttp.open("POST", "/save_settings", true);
    xhttp.send(JSON.stringify(settings));
  }

  // Get settings via API call.
  window.getSettings = function() {
    console.log("Getting settings via API.");
    $.ajax({
      url: "/get_settings"
    }).then(function(data) {
      settings = data;
      setSettings();
    });
  }

  /* Private Functions */

  // Update webinterface from settings.
  function setSettings() {
    document.getElementById("color").value = settings["led.color"];
    document.getElementById("brightness").value = (settings["led.brightness"] * 100);
  }

  // Get settings from webinterface.
  function getSettingsFromGui() {
    console.log("Getting settings from webinterface.")
    settings["led.color"] = document.getElementById("color").value;
    settings["led.brightness"] = (document.getElementById("brightness").value / 100);
  }
}(this, this.document));
